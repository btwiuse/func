{
  "res": [
    {
      "name": "get_world",
      "type": "aws_apigateway_method",
      "deps": [
        "world",
        "api"
      ],
      "input": {
        "api_key_required": null,
        "authorization_scopes": null,
        "authorization_type": "NONE",
        "authorizer_id": null,
        "http_method": "GET",
        "operation_name": null,
        "region": "eu-central-1",
        "request_models": null,
        "request_parameters": null,
        "request_validator_id": null,
        "resource_id": null,
        "rest_api_id": null
      }
    },
    {
      "name": "lambda_logs_doc",
      "type": "aws_iam_policy_document",
      "input": {
        "statement": [
          {
            "actions": [
              "logs:CreateLogGroup",
              "logs:CreateLogStream",
              "logs:PutLogEvents"
            ],
            "conditions": null,
            "effect": "Allow",
            "id": null,
            "not_actions": null,
            "not_principals": null,
            "not_resources": null,
            "principals": null,
            "resources": [
              "*"
            ]
          }
        ],
        "version": null
      }
    },
    {
      "name": "hello",
      "type": "aws_apigateway_resource",
      "deps": [
        "api"
      ],
      "input": {
        "parent_id": null,
        "path_part": "hello",
        "region": "eu-central-1",
        "rest_api_id": null
      }
    },
    {
      "name": "test_deployment",
      "type": "aws_apigateway_deployment",
      "deps": [
        "api",
        "invoke_lambda"
      ],
      "input": {
        "cache_cluster_enabled": null,
        "cache_cluster_size": null,
        "canary_settings": null,
        "change_trigger": null,
        "description": null,
        "region": "eu-central-1",
        "rest_api_id": null,
        "stage_description": null,
        "stage_name": null,
        "tracing_enabled": null,
        "variables": null
      }
    },
    {
      "name": "world",
      "type": "aws_apigateway_resource",
      "deps": [
        "hello",
        "api"
      ],
      "input": {
        "parent_id": null,
        "path_part": "world",
        "region": "eu-central-1",
        "rest_api_id": null
      }
    },
    {
      "name": "func",
      "type": "aws_lambda_function",
      "deps": [
        "lambda_role"
      ],
      "srcs": [
        "f6097389ad509b7d7d0a457bd4c997339fadefb0281c5f5a5706042dba386fc5"
      ],
      "input": {
        "dead_letter_config": null,
        "description": null,
        "environment": null,
        "function_name": "func-test",
        "handler": "index.handler",
        "kms_key_arn": null,
        "layers": null,
        "memory_size": null,
        "publish": null,
        "region": "eu-central-1",
        "role": null,
        "runtime": "nodejs8.10",
        "tags": null,
        "timeout": null,
        "tracing_config": null,
        "vpc_config": null
      }
    },
    {
      "name": "api",
      "type": "aws_apigateway_rest_api",
      "input": {
        "api_key_source": null,
        "binary_media_types": null,
        "clone_from": null,
        "description": null,
        "endpoint_configuration": null,
        "minimum_compression_size": null,
        "name": "func-test-api",
        "policy": null,
        "region": "eu-central-1",
        "version": null
      }
    },
    {
      "name": "apigateway_assume_doc",
      "type": "aws_iam_policy_document",
      "input": {
        "statement": [
          {
            "actions": [
              "sts:AssumeRole"
            ],
            "conditions": null,
            "effect": "Allow",
            "id": null,
            "not_actions": null,
            "not_principals": null,
            "not_resources": null,
            "principals": {
              "Service": [
                "apigateway.amazonaws.com"
              ]
            },
            "resources": null
          }
        ],
        "version": null
      }
    },
    {
      "name": "me",
      "type": "aws_sts_caller_identity",
      "input": {
        "region": null
      }
    },
    {
      "name": "lambda_logs_policy",
      "type": "aws_iam_policy",
      "deps": [
        "lambda_logs_doc"
      ],
      "input": {
        "description": "Grants access to write logs",
        "path": null,
        "policy_document": null,
        "policy_name": "func-logs",
        "region": null
      }
    },
    {
      "name": "apigateway_role",
      "type": "aws_iam_role",
      "deps": [
        "apigateway_assume_doc"
      ],
      "input": {
        "assume_role_policy_document": null,
        "description": "Exec role for Apigateway",
        "max_session_duration": null,
        "path": null,
        "permissions_boundary": null,
        "region": null,
        "role_name": "func-apigateway"
      }
    },
    {
      "name": "test_stage",
      "type": "aws_apigateway_stage",
      "deps": [
        "test_deployment",
        "api"
      ],
      "input": {
        "cache_cluster_enabled": null,
        "cache_cluster_size": null,
        "canary_settings": null,
        "deployment_id": null,
        "description": null,
        "documentation_version": null,
        "region": "eu-central-1",
        "rest_api_id": null,
        "stage_name": "test",
        "tags": null,
        "tracing_enabled": null,
        "variables": null
      }
    },
    {
      "name": "invoke_lambda",
      "type": "aws_lambda_invoke_permission",
      "deps": [
        "func",
        "api",
        "me",
        "get_world",
        "world"
      ],
      "input": {
        "action": "lambda:InvokeFunction",
        "event_source_token": null,
        "function_name": null,
        "principal": "apigateway.amazonaws.com",
        "qualifier": null,
        "region": "eu-central-1",
        "revision_id": null,
        "source_account": null,
        "source_arn": null,
        "statement_id": null
      }
    },
    {
      "name": "apigateway_exec",
      "type": "aws_iam_role_policy_attachment",
      "deps": [
        "lambda_exec_policy",
        "apigateway_role"
      ],
      "input": {
        "policy_arn": null,
        "region": null,
        "role_name": "func-apigateway"
      }
    },
    {
      "name": "lambda_role",
      "type": "aws_iam_role",
      "deps": [
        "lambda_assume_doc"
      ],
      "input": {
        "assume_role_policy_document": null,
        "description": "Exec role for Lambda",
        "max_session_duration": null,
        "path": null,
        "permissions_boundary": null,
        "region": null,
        "role_name": "func-lambda"
      }
    },
    {
      "name": "lambda_exec_policy",
      "type": "aws_iam_policy",
      "deps": [
        "lambda_exec_doc"
      ],
      "input": {
        "description": "Grants access to execute lambda",
        "path": null,
        "policy_document": null,
        "policy_name": "func-lambda-exec",
        "region": null
      }
    },
    {
      "name": "lambda_assume_doc",
      "type": "aws_iam_policy_document",
      "input": {
        "statement": [
          {
            "actions": [
              "sts:AssumeRole"
            ],
            "conditions": null,
            "effect": "Allow",
            "id": null,
            "not_actions": null,
            "not_principals": null,
            "not_resources": null,
            "principals": {
              "Service": [
                "lambda.amazonaws.com"
              ]
            },
            "resources": null
          }
        ],
        "version": null
      }
    },
    {
      "name": "trigger_lambda",
      "type": "aws_apigateway_integration",
      "deps": [
        "world",
        "api",
        "func",
        "get_world"
      ],
      "input": {
        "cache_key_parameters": null,
        "cache_namespace": null,
        "connection_id": null,
        "connection_type": null,
        "content_handling": null,
        "credentials": null,
        "http_method": "GET",
        "integration_http_method": "POST",
        "integration_type": "AWS_PROXY",
        "passthrough_behavior": null,
        "region": "eu-central-1",
        "request_parameters": null,
        "request_templates": null,
        "resource_id": null,
        "rest_api_id": null,
        "timeout_in_millis": null,
        "uri": null
      }
    },
    {
      "name": "lambda_logs_attach",
      "type": "aws_iam_role_policy_attachment",
      "deps": [
        "lambda_logs_policy",
        "lambda_role"
      ],
      "input": {
        "policy_arn": null,
        "region": null,
        "role_name": "func-lambda"
      }
    },
    {
      "name": "lambda_exec_doc",
      "type": "aws_iam_policy_document",
      "input": {
        "statement": [
          {
            "actions": [
              "lambda:InvokeFunction"
            ],
            "conditions": null,
            "effect": "Allow",
            "id": null,
            "not_actions": null,
            "not_principals": null,
            "not_resources": null,
            "principals": null,
            "resources": [
              "*"
            ]
          }
        ],
        "version": null
      }
    }
  ],
  "deps": {
    "apigateway_exec": [
      {
        "field": [
          "policy_arn"
        ],
        "expr": [
          {
            "ref": [
              "lambda_exec_policy",
              "arn"
            ]
          }
        ]
      }
    ],
    "apigateway_role": [
      {
        "field": [
          "assume_role_policy_document"
        ],
        "expr": [
          {
            "ref": [
              "apigateway_assume_doc",
              "json"
            ]
          }
        ]
      }
    ],
    "func": [
      {
        "field": [
          "role"
        ],
        "expr": [
          {
            "ref": [
              "lambda_role",
              "arn"
            ]
          }
        ]
      }
    ],
    "get_world": [
      {
        "field": [
          "rest_api_id"
        ],
        "expr": [
          {
            "ref": [
              "api",
              "id"
            ]
          }
        ]
      },
      {
        "field": [
          "resource_id"
        ],
        "expr": [
          {
            "ref": [
              "world",
              "id"
            ]
          }
        ]
      }
    ],
    "hello": [
      {
        "field": [
          "rest_api_id"
        ],
        "expr": [
          {
            "ref": [
              "api",
              "id"
            ]
          }
        ]
      },
      {
        "field": [
          "parent_id"
        ],
        "expr": [
          {
            "ref": [
              "api",
              "root_resource_id"
            ]
          }
        ]
      }
    ],
    "invoke_lambda": [
      {
        "field": [
          "function_name"
        ],
        "expr": [
          {
            "ref": [
              "func",
              "function_arn"
            ]
          }
        ]
      },
      {
        "field": [
          "statement_id"
        ],
        "expr": [
          {
            "lit": "apigateway-invoke-"
          },
          {
            "ref": [
              "world",
              "id"
            ]
          },
          {
            "lit": "-GET"
          }
        ]
      },
      {
        "field": [
          "source_arn"
        ],
        "expr": [
          {
            "lit": "arn:aws:execute-api:eu-central-1:"
          },
          {
            "ref": [
              "me",
              "account"
            ]
          },
          {
            "lit": ":"
          },
          {
            "ref": [
              "api",
              "id"
            ]
          },
          {
            "lit": "/*/GET"
          },
          {
            "ref": [
              "world",
              "path"
            ]
          }
        ]
      }
    ],
    "lambda_exec_policy": [
      {
        "field": [
          "policy_document"
        ],
        "expr": [
          {
            "ref": [
              "lambda_exec_doc",
              "json"
            ]
          }
        ]
      }
    ],
    "lambda_logs_attach": [
      {
        "field": [
          "policy_arn"
        ],
        "expr": [
          {
            "ref": [
              "lambda_logs_policy",
              "arn"
            ]
          }
        ]
      }
    ],
    "lambda_logs_policy": [
      {
        "field": [
          "policy_document"
        ],
        "expr": [
          {
            "ref": [
              "lambda_logs_doc",
              "json"
            ]
          }
        ]
      }
    ],
    "lambda_role": [
      {
        "field": [
          "assume_role_policy_document"
        ],
        "expr": [
          {
            "ref": [
              "lambda_assume_doc",
              "json"
            ]
          }
        ]
      }
    ],
    "test_deployment": [
      {
        "field": [
          "rest_api_id"
        ],
        "expr": [
          {
            "ref": [
              "api",
              "id"
            ]
          }
        ]
      },
      {
        "field": [
          "change_trigger"
        ],
        "expr": [
          {
            "ref": [
              "invoke_lambda",
              "statement"
            ]
          }
        ]
      }
    ],
    "test_stage": [
      {
        "field": [
          "rest_api_id"
        ],
        "expr": [
          {
            "ref": [
              "api",
              "id"
            ]
          }
        ]
      },
      {
        "field": [
          "deployment_id"
        ],
        "expr": [
          {
            "ref": [
              "test_deployment",
              "id"
            ]
          }
        ]
      }
    ],
    "trigger_lambda": [
      {
        "field": [
          "resource_id"
        ],
        "expr": [
          {
            "ref": [
              "world",
              "id"
            ]
          }
        ]
      },
      {
        "field": [
          "rest_api_id"
        ],
        "expr": [
          {
            "ref": [
              "api",
              "id"
            ]
          }
        ]
      },
      {
        "field": [
          "uri"
        ],
        "expr": [
          {
            "lit": "arn:aws:apigateway:eu-central-1:lambda:path/2015-03-31/functions/"
          },
          {
            "ref": [
              "func",
              "function_arn"
            ]
          },
          {
            "lit": "/invocations"
          }
        ]
      }
    ],
    "world": [
      {
        "field": [
          "rest_api_id"
        ],
        "expr": [
          {
            "ref": [
              "api",
              "id"
            ]
          }
        ]
      },
      {
        "field": [
          "parent_id"
        ],
        "expr": [
          {
            "ref": [
              "hello",
              "id"
            ]
          }
        ]
      }
    ]
  }
}
